import{s as he,b as h,f as C,t as K,g,k as y,h as j,d as _,r as q,j as O,l as n,i as F,m as a,v as ge,c as _e,n as me}from"../chunks/scheduler.Tn1ca7fi.js";import{S as ve,i as be,b as oe,d as re,m as ne,a as ie,t as ce,e as de}from"../chunks/index.CSvEDU_A.js";import{B as we}from"../chunks/Button.s6uCLvz5.js";import{U as Ce}from"../chunks/UploadSidebar.CRPbwSa5.js";import{r as ye,h as xe,u as De,i as $e,T as Se,d as Z,f as ue,b as ee,e as Ve,w as Ee}from"../chunks/client.Db5mx_yJ.js";import{P as ke}from"../chunks/papaparse.min.BuI-pYrM.js";import{p as Ue}from"../chunks/stores.CaxI_0xx.js";function fe(i){let e,s;return{c(){e=h("p"),s=K(i[0]),this.h()},l(t){e=g(t,"P",{class:!0});var l=j(e);s=O(l,i[0]),l.forEach(_),this.h()},h(){n(e,"class","text-green-600 mt-2")},m(t,l){F(t,e,l),a(e,s)},p(t,l){l&1&&me(s,t[0])},d(t){t&&_(e)}}}function pe(i){let e,s;return{c(){e=h("p"),s=K(i[1]),this.h()},l(t){e=g(t,"P",{class:!0});var l=j(e);s=O(l,i[1]),l.forEach(_),this.h()},h(){n(e,"class","text-red-600 mt-2")},m(t,l){F(t,e,l),a(e,s)},p(t,l){l&2&&me(s,t[1])},d(t){t&&_(e)}}}function je(i){let e;return{c(){e=K("Upload Screenshots")},l(s){e=O(s,"Upload Screenshots")},m(s,t){F(s,e,t)},d(s){s&&_(e)}}}function Ie(i){let e,s,t,l,b,I,c,$,N="After screenshotting your completed job, add screenshots",T,E,d="Make sure the following are visible:",f,r,H="<li>Job start/end date</li> <li>Hourly Charge/ Fixed Price</li> <li>Hours Per Week</li> <li>Client History</li> <li>Job Category</li>",M,x,R="Job information can be entered manually or via screenshot uploads.",L,k,u,S,W,G,V,Q,A,J,U,X,P,te='<i class="fas fa-play fa-2x mr-2"></i> <span>Learn more on how to add files or enter details</span>',z,Y,se;b=new Ce({});let p=i[0]&&fe(i),m=i[1]&&pe(i);return U=new we({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/upwork-job-screenshot",$$slots:{default:[je]},$$scope:{ctx:i}}}),{c(){e=h("link"),s=C(),t=h("div"),l=h("div"),oe(b.$$.fragment),I=C(),c=h("div"),$=h("p"),$.textContent=N,T=C(),E=h("p"),E.textContent=d,f=C(),r=h("ul"),r.innerHTML=H,M=C(),x=h("p"),x.textContent=R,L=C(),k=h("div"),u=h("div"),S=h("label"),W=K("Upload CSV"),G=C(),V=h("input"),Q=C(),p&&p.c(),A=C(),m&&m.c(),J=C(),oe(U.$$.fragment),X=C(),P=h("div"),P.innerHTML=te,this.h()},l(o){e=g(o,"LINK",{rel:!0,href:!0}),s=y(o),t=g(o,"DIV",{class:!0});var v=j(t);l=g(v,"DIV",{class:!0});var B=j(l);re(b.$$.fragment,B),B.forEach(_),I=y(v),c=g(v,"DIV",{class:!0});var w=j(c);$=g(w,"P",{class:!0,"data-svelte-h":!0}),q($)!=="svelte-1d34xwf"&&($.textContent=N),T=y(w),E=g(w,"P",{"data-svelte-h":!0}),q(E)!=="svelte-nbtji3"&&(E.textContent=d),f=y(w),r=g(w,"UL",{class:!0,"data-svelte-h":!0}),q(r)!=="svelte-19g3jim"&&(r.innerHTML=H),M=y(w),x=g(w,"P",{class:!0,"data-svelte-h":!0}),q(x)!=="svelte-kelqjq"&&(x.textContent=R),L=y(w),k=g(w,"DIV",{class:!0});var ae=j(k);u=g(ae,"DIV",{class:!0});var D=j(u);S=g(D,"LABEL",{class:!0,for:!0});var le=j(S);W=O(le,"Upload CSV"),le.forEach(_),G=y(D),V=g(D,"INPUT",{id:!0,type:!0,accept:!0,autocomplete:!0,class:!0}),Q=y(D),p&&p.l(D),A=y(D),m&&m.l(D),J=y(D),re(U.$$.fragment,D),D.forEach(_),ae.forEach(_),X=y(w),P=g(w,"DIV",{class:!0,"data-svelte-h":!0}),q(P)!=="svelte-11tx84z"&&(P.innerHTML=te),w.forEach(_),v.forEach(_),this.h()},h(){n(e,"rel","stylesheet"),n(e,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),n(l,"class","w-1/4"),n($,"class","mb-3"),n(r,"class","max-w-md mx-auto space-y-1 list-disc list-inside"),n(x,"class","mt-4"),n(S,"class","pb-2"),n(S,"for",i[2].id),n(V,"id",i[2].id),n(V,"type","file"),n(V,"accept",".csv"),n(V,"autocomplete","off"),n(V,"class","mt-1"),n(u,"class","flex flex-col items-center space-y-4 ml-56"),n(k,"class","flex justify-start mt-6"),n(P,"class","flex items-center mt-4 ml-49 text-black cursor-pointer"),n(c,"class","w-3/4 rounded-md p-6"),n(t,"class","flex flex-row")},m(o,v){F(o,e,v),F(o,s,v),F(o,t,v),a(t,l),ne(b,l,null),a(t,I),a(t,c),a(c,$),a(c,T),a(c,E),a(c,f),a(c,r),a(c,M),a(c,x),a(c,L),a(c,k),a(k,u),a(u,S),a(S,W),a(u,G),a(u,V),a(u,Q),p&&p.m(u,null),a(u,A),m&&m.m(u,null),a(u,J),ne(U,u,null),a(c,X),a(c,P),z=!0,Y||(se=ge(V,"change",i[3]),Y=!0)},p(o,[v]){o[0]?p?p.p(o,v):(p=fe(o),p.c(),p.m(u,A)):p&&(p.d(1),p=null),o[1]?m?m.p(o,v):(m=pe(o),m.c(),m.m(u,J)):m&&(m.d(1),m=null);const B={};v&512&&(B.$$scope={dirty:v,ctx:o}),U.$set(B)},i(o){z||(ie(b.$$.fragment,o),ie(U.$$.fragment,o),z=!0)},o(o){ce(b.$$.fragment,o),ce(U.$$.fragment,o),z=!1},d(o){o&&(_(e),_(s),_(t)),de(b),p&&p.d(),m&&m.d(),de(U),Y=!1,se()}}}function Le(i,e,s){let t;_e(i,Ue,d=>s(4,t=d));let l={id:"job_csv"},b="",I="",c=new Date().toISOString().substring(0,10);async function $(d){const f=d.target;if(f.files.length>0){const r=f.files[0];await N(r)}}async function N(d){if(d){console.log("File selected for upload:",d.name);try{const f=ye(xe,`uploads/${d.name}`);await De(f,d),console.log("File uploaded to storage:",d.name);const r=await $e(f);console.log("File download URL:",r),await T(d,r),console.log("File uploaded and metadata saved:",d.name),s(0,b="File uploaded successfully!")}catch(f){console.error("Error uploading file:",f),s(0,b=""),s(1,I="Error uploading file.")}}else console.error("No file selected"),s(1,I="No file selected"),s(0,b="")}async function T(d,f){ke.parse(d,{header:!0,async complete(r){console.log("Parsed CSV data:",r.data),await E(r.data,f)},error(r){console.error("Error parsing CSV file:",r)}})}async function E(d,f){const r=t.data.user;if(!r||!r.uid){console.error("User is not logged in");return}const H=Se.fromDate(new Date(c)),M=Z(ue(ee,"users",r.uid,"uploads")).id,x=Z(ee,"users",r.uid,"uploads",M);await Ve(x,{name:l.id,url:f,date:H});const R=Ee(ee);d.forEach((L,k)=>{const u=Z(ue(x,"jobs"),`job_${k}`),S={...L,date:H,csvDownloadURL:f};R.set(u,S)});try{await R.commit(),console.log("CSV data successfully uploaded to Firestore.")}catch(L){console.error("Error uploading CSV data to Firestore:",L)}}return[b,I,l,$]}class qe extends ve{constructor(e){super(),be(this,e,Le,Ie,he,{})}}export{qe as component};
