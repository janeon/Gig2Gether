import{s as ve,b as _,f as w,t as z,g as v,k as C,h as F,d as b,r as N,j as Q,l as d,i as q,m as l,v as be,c as $e,n as _e}from"../chunks/scheduler.Tn1ca7fi.js";import{S as we,i as Ce,b as te,d as se,m as ae,a as le,t as oe,e as re}from"../chunks/index.CSvEDU_A.js";import{B as pe}from"../chunks/Button.s6uCLvz5.js";import{U as ye}from"../chunks/UploadSidebar.CRPbwSa5.js";import{r as xe,h as De,u as Se,i as Ue,T as Ve,d as ne,f as me,b as ie,e as ke,w as Ee}from"../chunks/client.Db5mx_yJ.js";import{P as Ie}from"../chunks/papaparse.min.BuI-pYrM.js";import{p as Le}from"../chunks/stores.CaxI_0xx.js";function he(n){let e,t;return{c(){e=_("p"),t=z(n[0]),this.h()},l(s){e=v(s,"P",{class:!0});var o=F(e);t=Q(o,n[0]),o.forEach(b),this.h()},h(){d(e,"class","text-green-600 mt-2")},m(s,o){q(s,e,o),l(e,t)},p(s,o){o&1&&_e(t,s[0])},d(s){s&&b(e)}}}function ge(n){let e,t;return{c(){e=_("p"),t=z(n[1]),this.h()},l(s){e=v(s,"P",{class:!0});var o=F(e);t=Q(o,n[1]),o.forEach(b),this.h()},h(){d(e,"class","text-red-600 mt-2")},m(s,o){q(s,e,o),l(e,t)},p(s,o){o&2&&_e(t,s[1])},d(s){s&&b(e)}}}function Fe(n){let e;return{c(){e=z("Upload Screenshots")},l(t){e=Q(t,"Upload Screenshots")},m(t,s){q(t,e,s)},d(t){t&&b(e)}}}function Pe(n){let e;return{c(){e=z("Manual Upload")},l(t){e=Q(t,"Manual Upload")},m(t,s){q(t,e,s)},d(t){t&&b(e)}}}function Re(n){let e,t,s,o,x,V,i,D,A="We are collecting Quest offers to assess their quality, fairness, and achievability across drivers.",M,k,u="Quests include those that were:",f,r,T="<li>Received and not accepted</li> <li>Received but not completed</li> <li>Received and completed</li>",j,y,B="Quest information can be entered manually or via screenshot uploads.",P,E,c,S,G,J,U,X,K,O,I,Y,L,Z,R,ce='<i class="fas fa-play fa-2x mr-2"></i> <span>Learn more on how to add files or enter details</span>',W,ee,de;x=new ye({});let p=n[0]&&he(n),m=n[1]&&ge(n);return I=new pe({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/quest-screenshot",$$slots:{default:[Fe]},$$scope:{ctx:n}}}),L=new pe({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/manual-quests",$$slots:{default:[Pe]},$$scope:{ctx:n}}}),{c(){e=_("link"),t=w(),s=_("div"),o=_("div"),te(x.$$.fragment),V=w(),i=_("div"),D=_("p"),D.textContent=A,M=w(),k=_("p"),k.textContent=u,f=w(),r=_("ul"),r.innerHTML=T,j=w(),y=_("p"),y.textContent=B,P=w(),E=_("div"),c=_("div"),S=_("label"),G=z("Upload CSV"),J=w(),U=_("input"),X=w(),p&&p.c(),K=w(),m&&m.c(),O=w(),te(I.$$.fragment),Y=w(),te(L.$$.fragment),Z=w(),R=_("div"),R.innerHTML=ce,this.h()},l(a){e=v(a,"LINK",{rel:!0,href:!0}),t=C(a),s=v(a,"DIV",{class:!0});var h=F(s);o=v(h,"DIV",{class:!0});var H=F(o);se(x.$$.fragment,H),H.forEach(b),V=C(h),i=v(h,"DIV",{class:!0});var g=F(i);D=v(g,"P",{class:!0,"data-svelte-h":!0}),N(D)!=="svelte-ihj9wl"&&(D.textContent=A),M=C(g),k=v(g,"P",{"data-svelte-h":!0}),N(k)!=="svelte-1sekmii"&&(k.textContent=u),f=C(g),r=v(g,"UL",{class:!0,"data-svelte-h":!0}),N(r)!=="svelte-1r4kkpz"&&(r.innerHTML=T),j=C(g),y=v(g,"P",{class:!0,"data-svelte-h":!0}),N(y)!=="svelte-1g5548b"&&(y.textContent=B),P=C(g),E=v(g,"DIV",{class:!0});var ue=F(E);c=v(ue,"DIV",{class:!0});var $=F(c);S=v($,"LABEL",{class:!0,for:!0});var fe=F(S);G=Q(fe,"Upload CSV"),fe.forEach(b),J=C($),U=v($,"INPUT",{id:!0,type:!0,accept:!0,autocomplete:!0,class:!0}),X=C($),p&&p.l($),K=C($),m&&m.l($),O=C($),se(I.$$.fragment,$),Y=C($),se(L.$$.fragment,$),$.forEach(b),ue.forEach(b),Z=C(g),R=v(g,"DIV",{class:!0,"data-svelte-h":!0}),N(R)!=="svelte-k3iify"&&(R.innerHTML=ce),g.forEach(b),h.forEach(b),this.h()},h(){d(e,"rel","stylesheet"),d(e,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),d(o,"class","w-1/4"),d(D,"class","mb-3"),d(r,"class","max-w-md mx-auto space-y-1 list-disc list-inside"),d(y,"class","mt-4"),d(S,"class","pb-2"),d(S,"for",n[2].id),d(U,"id",n[2].id),d(U,"type","file"),d(U,"accept",".csv"),d(U,"autocomplete","off"),d(U,"class","mt-1"),d(c,"class","flex flex-col items-center space-y-4 ml-56"),d(E,"class","flex justify-start mt-6"),d(R,"class","flex items-center mt-4 ml-59 text-black cursor-pointer"),d(i,"class","w-3/4 rounded-md p-6"),d(s,"class","flex flex-row")},m(a,h){q(a,e,h),q(a,t,h),q(a,s,h),l(s,o),ae(x,o,null),l(s,V),l(s,i),l(i,D),l(i,M),l(i,k),l(i,f),l(i,r),l(i,j),l(i,y),l(i,P),l(i,E),l(E,c),l(c,S),l(S,G),l(c,J),l(c,U),l(c,X),p&&p.m(c,null),l(c,K),m&&m.m(c,null),l(c,O),ae(I,c,null),l(c,Y),ae(L,c,null),l(i,Z),l(i,R),W=!0,ee||(de=be(U,"change",n[3]),ee=!0)},p(a,[h]){a[0]?p?p.p(a,h):(p=he(a),p.c(),p.m(c,K)):p&&(p.d(1),p=null),a[1]?m?m.p(a,h):(m=ge(a),m.c(),m.m(c,O)):m&&(m.d(1),m=null);const H={};h&512&&(H.$$scope={dirty:h,ctx:a}),I.$set(H);const g={};h&512&&(g.$$scope={dirty:h,ctx:a}),L.$set(g)},i(a){W||(le(x.$$.fragment,a),le(I.$$.fragment,a),le(L.$$.fragment,a),W=!0)},o(a){oe(x.$$.fragment,a),oe(I.$$.fragment,a),oe(L.$$.fragment,a),W=!1},d(a){a&&(b(e),b(t),b(s)),re(x),p&&p.d(),m&&m.d(),re(I),re(L),ee=!1,de()}}}function qe(n,e,t){let s;$e(n,Le,u=>t(4,s=u));let o={id:"quest_csv"},x=new Date().toISOString().substring(0,10),V="",i="";async function D(u){const f=u.target;if(f.files.length>0){const r=f.files[0];await A(r)}}async function A(u){if(u){console.log("File selected for upload:",u.name);try{const f=xe(De,`uploads/${u.name}`);await Se(f,u),console.log("File uploaded to storage:",u.name);const r=await Ue(f);console.log("File download URL:",r),await M(u,r),console.log("File uploaded and metadata saved:",u.name),t(0,V="File uploaded successfully!")}catch(f){console.error("Error uploading file:",f),t(0,V=""),t(1,i="Error uploading file.")}}else console.error("No file selected"),t(1,i="No file selected"),t(0,V="")}async function M(u,f){Ie.parse(u,{header:!0,async complete(r){console.log("Parsed CSV data:",r.data),await k(r.data,f)},error(r){console.error("Error parsing CSV file:",r)}})}async function k(u,f){const r=s.data.user;if(!r||!r.uid){console.error("User is not logged in");return}const T=Ve.fromDate(new Date(x)),j=ne(me(ie,"users",r.uid,"uploads")).id,y=ne(ie,"users",r.uid,"uploads",j);await ke(y,{name:o.id,url:f,date:T});const B=Ee(ie);u.forEach((P,E)=>{const c=ne(me(y,"quests"),`quest_${E}`),S={...P,date:T,csvDownloadURL:f};B.set(c,S)});try{await B.commit(),console.log("CSV data successfully uploaded to Firestore.")}catch(P){console.error("Error uploading CSV data to Firestore:",P)}}return[V,i,o,D]}class Qe extends we{constructor(e){super(),Ce(this,e,qe,Re,ve,{})}}export{Qe as component};
