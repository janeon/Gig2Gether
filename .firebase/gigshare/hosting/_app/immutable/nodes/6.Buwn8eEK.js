import{s as U,b as h,f as E,g as y,h as T,k as x,r as I,d as g,l as i,i as O,m,v as L,x as M,q as P,w as N,t as S,j as V,y as A,n as H,z as W}from"../chunks/scheduler.Tn1ca7fi.js";import{S as j,i as z}from"../chunks/index.CSvEDU_A.js";import{e as B}from"../chunks/forms.OTAKVcbA.js";import{c as F,a as D,d as G,b as J,e as K}from"../chunks/client.Db5mx_yJ.js";function R(d){let r,e,t=d[0].formErrors+"",n;return{c(){r=h("article"),e=h("div"),n=S(t),this.h()},l(a){r=y(a,"ARTICLE",{});var u=T(r);e=y(u,"DIV",{style:!0});var s=T(e);n=V(s,t),s.forEach(g),u.forEach(g),this.h()},h(){A(e,"color","red")},m(a,u){O(a,r,u),m(r,e),m(e,n)},p(a,u){u&1&&t!==(t=a[0].formErrors+"")&&H(n,t)},d(a){a&&g(r)}}}function Q(d){var C;let r,e,t,n,a,u,s,f='<p>Role</p> <input id="policy" name="role" type="radio" value="policy" required=""/> <label for="policy">Policymaker</label><br/> <input id="worker" name="role" type="radio" value="worker" required=""/> <label for="worker">Worker</label><br/>',w,_,l,v="Register",k,q,o=((C=d[0])==null?void 0:C.formErrors)&&R(d);return{c(){r=h("div"),e=h("form"),t=h("input"),n=E(),a=h("input"),u=E(),s=h("div"),s.innerHTML=f,w=E(),o&&o.c(),_=E(),l=h("button"),l.textContent=v,this.h()},l(p){r=y(p,"DIV",{class:!0});var b=T(r);e=y(b,"FORM",{class:!0,action:!0,method:!0});var c=T(e);t=y(c,"INPUT",{type:!0,placeholder:!0,name:!0,class:!0}),n=x(c),a=y(c,"INPUT",{type:!0,placeholder:!0,name:!0,class:!0}),u=x(c),s=y(c,"DIV",{"data-svelte-h":!0}),I(s)!=="svelte-1d1xxpq"&&(s.innerHTML=f),w=x(c),o&&o.l(c),_=x(c),l=y(c,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),I(l)!=="svelte-3dy3v2"&&(l.textContent=v),c.forEach(g),b.forEach(g),this.h()},h(){i(t,"type","email"),i(t,"placeholder","email"),i(t,"name","email"),i(t,"class","px-4 py-2 border border-gray-300 rounded-md"),t.required=!0,i(a,"type","password"),i(a,"placeholder","password"),i(a,"name","password"),i(a,"class","px-4 py-2 border border-gray-300 rounded-md"),a.required=!0,i(l,"type","submit"),i(l,"class","default-action"),i(e,"class","flex flex-col gap-4 p-8 space-y-4 bg-white sm:w-6/12"),i(e,"action","?/register"),i(e,"method","POST"),i(r,"class","flex flex-col items-center")},m(p,b){O(p,r,b),m(r,e),m(e,t),m(e,n),m(e,a),m(e,u),m(e,s),m(e,w),o&&o.m(e,null),m(e,_),m(e,l),d[3](e),k||(q=[L(l,"click",d[1]),M(B.call(null,e))],k=!0)},p(p,[b]){var c;(c=p[0])!=null&&c.formErrors?o?o.p(p,b):(o=R(p),o.c(),o.m(e,_)):o&&(o.d(1),o=null)},i:P,o:P,d(p){p&&g(r),o&&o.d(),d[3](null),k=!1,N(q)}}}function X(d,r,e){let{form:t}=r,n;async function a(s){s.preventDefault();try{const f=t.email.value,w=t.password.value,_=await F(D,f,w);e(2,n=await _.user.getIdToken());try{const v=_.user,k=G(J,"users",v.uid);await K(k,{email:f,role:t.role.value})}catch(v){console.error(v.message)}await D.signOut();const l=document.createElement("input");l.type="hidden",l.name="token",l.value=n,t.appendChild(l),t.submit()}catch(f){console.error(f),e(0,t.formErrors=f.code.split("/")[1],t)}}function u(s){W[s?"unshift":"push"](()=>{t=s,e(0,t)})}return d.$$set=s=>{"form"in s&&e(0,t=s.form)},d.$$.update=()=>{d.$$.dirty&4&&console.log("token",n)},[t,a,n,u]}class te extends j{constructor(r){super(),z(this,r,X,Q,U,{form:0})}}export{te as component};
