import{s as ie,b as c,f as w,t as re,g as d,k as C,h as E,d as v,r as H,j as ne,l as o,i as q,m as e,v as ce,c as de}from"../chunks/scheduler.Tn1ca7fi.js";import{S as ue,i as pe,b as Z,d as ee,m as te,a as ae,t as se,e as oe}from"../chunks/index.CSvEDU_A.js";import{B as fe}from"../chunks/Button.s6uCLvz5.js";import{U as me}from"../chunks/UploadSidebar.CwuGyvda.js";import{r as he,h as ve,u as ge,i as be,T as _e,d as O,f as le,b as W,e as xe,w as $e}from"../chunks/client.Db5mx_yJ.js";import{P as we}from"../chunks/papaparse.min.BuI-pYrM.js";import{p as Ce}from"../chunks/stores.SUmdyQM3.js";function ye(y){let n;return{c(){n=re("Upload Screenshots")},l(u){n=ne(u,"Upload Screenshots")},m(u,i){q(u,n,i)},d(u){u&&v(n)}}}function De(y){let n,u,i,g,b,F,s,_,R="After screenshotting your completed job, add screenshots",t,a,l="Make sure the following are visible:",j,x,P="<li>Job start/end date</li> <li>Hourly Charge/ Fixed Price</li> <li>Hours Per Week</li> <li>Client History</li> <li>Job Category</li>",I,f,B="Job information can be entered manually or via screenshot uploads.",k,D,h,V,A,J,$,N,S,z,U,G='<i class="fas fa-play fa-2x mr-2"></i> <span>Learn more on how to add files or enter details</span>',M,K,Q;return b=new me({}),S=new fe({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/upwork-job-screenshot",$$slots:{default:[ye]},$$scope:{ctx:y}}}),{c(){n=c("link"),u=w(),i=c("div"),g=c("div"),Z(b.$$.fragment),F=w(),s=c("div"),_=c("p"),_.textContent=R,t=w(),a=c("p"),a.textContent=l,j=w(),x=c("ul"),x.innerHTML=P,I=w(),f=c("p"),f.textContent=B,k=w(),D=c("div"),h=c("div"),V=c("label"),A=re("Upload CSV"),J=w(),$=c("input"),N=w(),Z(S.$$.fragment),z=w(),U=c("div"),U.innerHTML=G,this.h()},l(r){n=d(r,"LINK",{rel:!0,href:!0}),u=C(r),i=d(r,"DIV",{class:!0});var m=E(i);g=d(m,"DIV",{class:!0});var T=E(g);ee(b.$$.fragment,T),T.forEach(v),F=C(m),s=d(m,"DIV",{class:!0});var p=E(s);_=d(p,"P",{class:!0,"data-svelte-h":!0}),H(_)!=="svelte-1d34xwf"&&(_.textContent=R),t=C(p),a=d(p,"P",{"data-svelte-h":!0}),H(a)!=="svelte-nbtji3"&&(a.textContent=l),j=C(p),x=d(p,"UL",{class:!0,"data-svelte-h":!0}),H(x)!=="svelte-19g3jim"&&(x.innerHTML=P),I=C(p),f=d(p,"P",{class:!0,"data-svelte-h":!0}),H(f)!=="svelte-kelqjq"&&(f.textContent=B),k=C(p),D=d(p,"DIV",{class:!0});var X=E(D);h=d(X,"DIV",{class:!0});var L=E(h);V=d(L,"LABEL",{class:!0,for:!0});var Y=E(V);A=ne(Y,"Upload CSV"),Y.forEach(v),J=C(L),$=d(L,"INPUT",{id:!0,type:!0,accept:!0,autocomplete:!0,class:!0}),N=C(L),ee(S.$$.fragment,L),L.forEach(v),X.forEach(v),z=C(p),U=d(p,"DIV",{class:!0,"data-svelte-h":!0}),H(U)!=="svelte-11tx84z"&&(U.innerHTML=G),p.forEach(v),m.forEach(v),this.h()},h(){o(n,"rel","stylesheet"),o(n,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),o(g,"class","w-1/4"),o(_,"class","mb-3"),o(x,"class","max-w-md mx-auto space-y-1 list-disc list-inside"),o(f,"class","mt-4"),o(V,"class","pb-2"),o(V,"for",y[0].id),o($,"id",y[0].id),o($,"type","file"),o($,"accept",".csv"),o($,"autocomplete","off"),o($,"class","mt-1"),o(h,"class","flex flex-col items-center space-y-4 ml-56"),o(D,"class","flex justify-start mt-6"),o(U,"class","flex items-center mt-4 ml-49 text-black cursor-pointer"),o(s,"class","w-3/4 rounded-md p-6"),o(i,"class","flex flex-row")},m(r,m){q(r,n,m),q(r,u,m),q(r,i,m),e(i,g),te(b,g,null),e(i,F),e(i,s),e(s,_),e(s,t),e(s,a),e(s,j),e(s,x),e(s,I),e(s,f),e(s,k),e(s,D),e(D,h),e(h,V),e(V,A),e(h,J),e(h,$),e(h,N),te(S,h,null),e(s,z),e(s,U),M=!0,K||(Q=ce($,"change",y[1]),K=!0)},p(r,[m]){const T={};m&128&&(T.$$scope={dirty:m,ctx:r}),S.$set(T)},i(r){M||(ae(b.$$.fragment,r),ae(S.$$.fragment,r),M=!0)},o(r){se(b.$$.fragment,r),se(S.$$.fragment,r),M=!1},d(r){r&&(v(n),v(u),v(i)),oe(b),oe(S),K=!1,Q()}}}function Se(y,n,u){let i;de(y,Ce,t=>u(2,i=t));let g={id:"job_csv"},b=new Date().toISOString().substring(0,10);async function F(t){const a=t.target;if(a.files.length>0){const l=a.files[0];await s(l)}}async function s(t){if(t){console.log("File selected for upload:",t.name);try{const a=he(ve,`uploads/${t.name}`);await ge(a,t),console.log("File uploaded to storage:",t.name);const l=await be(a);console.log("File download URL:",l),await _(t,l),console.log("File uploaded and metadata saved:",t.name)}catch(a){console.error("Error uploading file:",a)}}else console.error("No file selected")}async function _(t,a){we.parse(t,{header:!0,async complete(l){console.log("Parsed CSV data:",l.data),await R(l.data,a)},error(l){console.error("Error parsing CSV file:",l)}})}async function R(t,a){const l=i.data.user;if(!l||!l.uid){console.error("User is not logged in");return}const j=_e.fromDate(new Date(b)),x=O(le(W,"users",l.uid,"uploads")).id,P=O(W,"users",l.uid,"uploads",x);await xe(P,{name:g.id,url:a,date:j});const I=$e(W);t.forEach((f,B)=>{const k=O(le(P,"jobs"),`job_${B}`),D={...f,date:j,csvDownloadURL:a};I.set(k,D)});try{await I.commit(),console.log("CSV data successfully uploaded to Firestore.")}catch(f){console.error("Error uploading CSV data to Firestore:",f)}}return[g,F]}class Pe extends ue{constructor(n){super(),pe(this,n,Se,De,ie,{})}}export{Pe as component};
