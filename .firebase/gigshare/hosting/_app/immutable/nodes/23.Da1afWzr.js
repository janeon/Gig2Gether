import{s as ce,b as _,f as C,t as B,g as b,k as V,h as x,d as m,r as ae,j,l as d,i as L,m as i,v as de,c as fe,n as ie}from"../chunks/scheduler.Tn1ca7fi.js";import{S as ue,i as pe,b as K,d as O,m as G,a as J,t as Q,e as W}from"../chunks/index.CSvEDU_A.js";import{B as oe}from"../chunks/Button.s6uCLvz5.js";import{U as me}from"../chunks/UploadSidebar.CRPbwSa5.js";import{r as he,h as ge,u as _e,i as be,T as ve,d as X,f as le,b as Y,e as $e,w as we}from"../chunks/client.Db5mx_yJ.js";import{P as De}from"../chunks/papaparse.min.BuI-pYrM.js";import{p as ye}from"../chunks/stores.CaxI_0xx.js";function re(r){let e,s;return{c(){e=_("p"),s=B(r[0]),this.h()},l(a){e=b(a,"P",{class:!0});var l=x(e);s=j(l,r[0]),l.forEach(m),this.h()},h(){d(e,"class","text-green-600 mt-2")},m(a,l){L(a,e,l),i(e,s)},p(a,l){l&1&&ie(s,a[0])},d(a){a&&m(e)}}}function ne(r){let e,s;return{c(){e=_("p"),s=B(r[1]),this.h()},l(a){e=b(a,"P",{class:!0});var l=x(e);s=j(l,r[1]),l.forEach(m),this.h()},h(){d(e,"class","text-red-600 mt-2")},m(a,l){L(a,e,l),i(e,s)},p(a,l){l&2&&ie(s,a[1])},d(a){a&&m(e)}}}function Se(r){let e;return{c(){e=B("Upload Screenshots")},l(s){e=j(s,"Upload Screenshots")},m(s,a){L(s,e,a)},d(s){s&&m(e)}}}function Ce(r){let e;return{c(){e=B("Manual Upload")},l(s){e=j(s,"Manual Upload")},m(s,a){L(s,e,a)},d(s){s&&m(e)}}}function Ve(r){let e,s,a,l,D,E,h,y,N="Trips information are collected per ride, and both trip offers and summaries can be entered manually or via screenshot uploads.",M,U,t,n,c,P,v,T,k,I,$,R,w,A,F,Z='<i class="fas fa-play fa-2x mr-2"></i> <span>Learn more on how to add files or enter details</span>',q,H,ee;D=new me({});let f=r[0]&&re(r),u=r[1]&&ne(r);return $=new oe({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/trip-screenshot",$$slots:{default:[Se]},$$scope:{ctx:r}}}),w=new oe({props:{class:"bg-black text-white rounded px-6 py-3",size:"xl",href:"/protected/manual-trips",$$slots:{default:[Ce]},$$scope:{ctx:r}}}),{c(){e=_("link"),s=C(),a=_("div"),l=_("div"),K(D.$$.fragment),E=C(),h=_("div"),y=_("p"),y.textContent=N,M=C(),U=_("div"),t=_("div"),n=_("label"),c=B("Upload CSV"),P=C(),v=_("input"),T=C(),f&&f.c(),k=C(),u&&u.c(),I=C(),K($.$$.fragment),R=C(),K(w.$$.fragment),A=C(),F=_("div"),F.innerHTML=Z,this.h()},l(o){e=b(o,"LINK",{rel:!0,href:!0}),s=V(o),a=b(o,"DIV",{class:!0});var p=x(a);l=b(p,"DIV",{class:!0});var z=x(l);O(D.$$.fragment,z),z.forEach(m),E=V(p),h=b(p,"DIV",{class:!0});var S=x(h);y=b(S,"P",{class:!0,"data-svelte-h":!0}),ae(y)!=="svelte-y8oszz"&&(y.textContent=N),M=V(S),U=b(S,"DIV",{class:!0});var te=x(U);t=b(te,"DIV",{class:!0});var g=x(t);n=b(g,"LABEL",{class:!0,for:!0});var se=x(n);c=j(se,"Upload CSV"),se.forEach(m),P=V(g),v=b(g,"INPUT",{id:!0,type:!0,accept:!0,autocomplete:!0,class:!0}),T=V(g),f&&f.l(g),k=V(g),u&&u.l(g),I=V(g),O($.$$.fragment,g),R=V(g),O(w.$$.fragment,g),g.forEach(m),te.forEach(m),A=V(S),F=b(S,"DIV",{class:!0,"data-svelte-h":!0}),ae(F)!=="svelte-11tx84z"&&(F.innerHTML=Z),S.forEach(m),p.forEach(m),this.h()},h(){d(e,"rel","stylesheet"),d(e,"href","https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"),d(l,"class","w-1/4"),d(y,"class","mb-3"),d(n,"class","pb-2"),d(n,"for",r[2].id),d(v,"id",r[2].id),d(v,"type","file"),d(v,"accept",".csv"),d(v,"autocomplete","off"),d(v,"class","mt-1"),d(t,"class","flex flex-col items-center space-y-4 ml-56"),d(U,"class","flex justify-start mt-6"),d(F,"class","flex items-center mt-4 ml-49 text-black cursor-pointer"),d(h,"class","w-3/4 rounded-md p-6"),d(a,"class","flex flex-row")},m(o,p){L(o,e,p),L(o,s,p),L(o,a,p),i(a,l),G(D,l,null),i(a,E),i(a,h),i(h,y),i(h,M),i(h,U),i(U,t),i(t,n),i(n,c),i(t,P),i(t,v),i(t,T),f&&f.m(t,null),i(t,k),u&&u.m(t,null),i(t,I),G($,t,null),i(t,R),G(w,t,null),i(h,A),i(h,F),q=!0,H||(ee=de(v,"change",r[3]),H=!0)},p(o,[p]){o[0]?f?f.p(o,p):(f=re(o),f.c(),f.m(t,k)):f&&(f.d(1),f=null),o[1]?u?u.p(o,p):(u=ne(o),u.c(),u.m(t,I)):u&&(u.d(1),u=null);const z={};p&512&&(z.$$scope={dirty:p,ctx:o}),$.$set(z);const S={};p&512&&(S.$$scope={dirty:p,ctx:o}),w.$set(S)},i(o){q||(J(D.$$.fragment,o),J($.$$.fragment,o),J(w.$$.fragment,o),q=!0)},o(o){Q(D.$$.fragment,o),Q($.$$.fragment,o),Q(w.$$.fragment,o),q=!1},d(o){o&&(m(e),m(s),m(a)),W(D),f&&f.d(),u&&u.d(),W($),W(w),H=!1,ee()}}}function Ee(r,e,s){let a;fe(r,ye,t=>s(4,a=t));let l={id:"trip_csv"},D=new Date().toISOString().substring(0,10),E="",h="";async function y(t){const n=t.target;if(n.files.length>0){const c=n.files[0];await N(c)}}async function N(t){if(t){console.log("File selected for upload:",t.name);try{const n=he(ge,`uploads/${t.name}`);await _e(n,t),console.log("File uploaded to storage:",t.name);const c=await be(n);console.log("File download URL:",c),await M(t,c),console.log("File uploaded and metadata saved:",t.name),s(0,E="File uploaded successfully!")}catch(n){console.error("Error uploading file:",n),s(0,E=""),s(1,h="Error uploading file.")}}else console.error("No file selected"),s(1,h="No file selected"),s(0,E="")}async function M(t,n){De.parse(t,{header:!0,async complete(c){console.log("Parsed CSV data:",c.data),await U(c.data,n)},error(c){console.error("Error parsing CSV file:",c)}})}async function U(t,n){const c=a.data.user;if(!c||!c.uid){console.error("User is not logged in");return}const P=ve.fromDate(new Date(D)),v=X(le(Y,"users",c.uid,"uploads")).id,T=X(Y,"users",c.uid,"uploads",v);await $e(T,{name:l.id,url:n,date:P});const k=we(Y);t.forEach((I,$)=>{const R=X(le(T,"trips"),`trip_${$}`),w={...I,date:P,csvDownloadURL:n};k.set(R,w)});try{await k.commit(),console.log("CSV data successfully uploaded to Firestore.")}catch(I){console.error("Error uploading CSV data to Firestore:",I)}}return[E,h,l,y]}class Te extends ue{constructor(e){super(),pe(this,e,Ee,Ve,ce,{})}}export{Te as component};
